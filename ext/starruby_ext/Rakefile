# Generated by mkrf 0.2.5
# on 01/02/14
# at 16:23:24
require 'rake/clean'

CLEAN.include('*.o')
CLOBBER.include('starruby_ext.so', 'mkrf.log')

SRC = FileList['*.c','*.cpp']
OBJ = SRC.ext('o')
CC = 'gcc'
CXXC = 'gcc'

ADDITIONAL_OBJECTS = ''

LDSHARED = "gcc -shared  -lSDL -lpthread  -L/usr/lib -lz "

LIBPATH =  "-L/usr/lib "

INCLUDES = "-I/usr/include/ruby-2.1.0 -I/usr/include/ruby-2.1.0/x86_64-linux -I/usr/lib/ruby/2.1.0/x86_64-linux -I/usr/lib/ruby/site_ruby/2.1.0 -I."

LIBS = "-lpthread -lgmp -ldl -lcrypt -lm -lSDL_mixer -lfreetype -lSDL_ttf -lpng -lGL -lfontconfig -lgomp"

CFLAGS = "-fPIC -march=x86-64 -mtune=generic -O2 -pipe -fstack-protector --param=ssp-buffer-size=4 -fPIC  -std=c99 -fopenmp -I/home/icy/Dropbox/code/Git/starruby/ext/starruby_ext/include -D_GNU_SOURCE=1 -D_REENTRANT -I/usr/include/SDL   -DSTRB_USE_AUDIO -DHAVE_SDL_MIXER -DHAVE_SDL_TTF -DHAVE_LIBPNG -DSTRB_CAN_LOAD_PNG -DSTRB_CAN_SAVE_PNG -DHAVE_OPENGL -DHAVE_ZLIB -DHAVE_FONTCONFIG_FONTCONFIG_H -DHAVE_FONTCONFIG -DHAVE_OPENMP"

RUBYARCHDIR = "#{ENV["RUBYARCHDIR"]}"
LIBRUBYARG_SHARED = "-lruby"

task :default => ['starruby_ext.so']

rule '.o' => '.cpp' do |t|
  sh "#{CXXC} #{CFLAGS} #{INCLUDES} -c #{t.source}"
end
rule '.o' => '.c' do |t|
  sh "#{CC} #{CFLAGS} #{INCLUDES} -c #{t.source}"
end

desc "Build this extension"
file 'starruby_ext.so' => OBJ do
  sh "#{LDSHARED} #{LIBPATH} -o starruby_ext.so #{OBJ} #{ADDITIONAL_OBJECTS} #{LIBS} #{LIBRUBYARG_SHARED}"
end

desc "Install this extension"
task :install => 'starruby_ext.so' do
  makedirs "#{RUBYARCHDIR}"
  install "starruby_ext.so", "#{RUBYARCHDIR}"
end


