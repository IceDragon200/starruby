# Generated by mkrf 0.2.5
# on 04/20/13
# at 17:53:02
require 'rake/clean'

CLEAN.include('*.o')
CLOBBER.include('starruby.so', 'mkrf.log')

SRC = FileList['*.c','*.cpp']
OBJ = SRC.ext('o')
CC = 'clang'
CPPC = 'gcc'

ADDITIONAL_OBJECTS = ''

LDSHARED = "gcc -shared  -lcairo  -lglib-2.0  -lgdk_pixbuf-2.0 -lgobject-2.0 -lglib-2.0  -lrsvg-2 -lm -lgio-2.0 -lgdk_pixbuf-2.0 -lgobject-2.0 -lglib-2.0 -lcairo  -L/usr/lib -lSDL -lpthread"

LIBPATH =  "-L/usr/local/lib "

INCLUDES = "-I/usr/local/include/ruby-2.0.0 -I/usr/local/include/ruby-2.0.0/x86_64-linux -I/usr/local/lib/ruby/2.0.0/x86_64-linux -I/usr/local/lib/ruby/site_ruby/2.0.0 -I."

LIBS = "-lpthread -lrt -ldl -lcrypt -lm -lpng -lfontconfig -lSDL_mixer -lSDL_image -lSDL_ttf -lGL"

CFLAGS = "-fPIC  -O3 -fno-fast-math -ggdb3 -Wall -Wextra -Wno-unused-parameter -Wno-parentheses -Wno-long-long -Wno-missing-field-initializers -Wunused-variable      -std=c99 -I/usr/include/cairo -I/usr/include/glib-2.0 -I/usr/lib/glib-2.0/include -I/usr/include/pixman-1 -I/usr/include/freetype2 -I/usr/include/libdrm -I/usr/include/libpng15  -I/home/icy/Dropbox/code/Git/Kyameru/src -I/usr/local/lib/ruby/gems/2.0.0/gems/cairo-1.12.4/lib -D CAN_LOAD_SVG  -I/usr/include/glib-2.0 -I/usr/lib/glib-2.0/include  -pthread -I/usr/include/gdk-pixbuf-2.0 -I/usr/include/libpng15 -I/usr/include/glib-2.0 -I/usr/lib/glib-2.0/include  -pthread -I/usr/include/librsvg-2.0 -I/usr/include/gdk-pixbuf-2.0 -I/usr/include/libpng15 -I/usr/include/cairo -I/usr/include/glib-2.0 -I/usr/lib/glib-2.0/include -I/usr/include/pixman-1 -I/usr/include/freetype2 -I/usr/include/libdrm -I/usr/include/libpng15  -I/usr/include/SDL -D_GNU_SOURCE=1 -D_REENTRANT -D HAVE_SDL_MIXER  -D HAVE_SDL_IMAGE  -D HAVE_SDL_TTF  -DHAVE_FONTCONFIG_FONTCONFIG_H"

RUBYARCHDIR = "#{ENV["RUBYARCHDIR"]}"
LIBRUBYARG_SHARED = "-Wl,-R -Wl,/usr/local/lib -L/usr/local/lib "

task :default => ['starruby.so']

rule '.o' => '.cpp' do |t|
  sh "#{CPPC} #{CFLAGS} #{INCLUDES} -c #{t.source}"
end
rule '.o' => '.c' do |t|
  sh "#{CC} #{CFLAGS} #{INCLUDES} -c #{t.source}"
end

desc "Build this extension"
file 'starruby.so' => OBJ do
  sh "#{LDSHARED} #{LIBPATH} -o starruby.so #{OBJ} #{ADDITIONAL_OBJECTS} #{LIBS} #{LIBRUBYARG_SHARED}"
end

desc "Install this extension"
task :install => 'starruby.so' do
  makedirs "#{RUBYARCHDIR}"
  install "starruby.so", "#{RUBYARCHDIR}"
end


